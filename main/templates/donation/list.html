{% extends "layouts/master_sidebar.html" %}
{% load static %}

{% block extrahead %} <link rel="stylesheet" type="text/css" href="{% static 'styles/donation.css' %}"> {% endblock %}


{% block objectFor %}
{% for object in objects %}
<div class="object border border-dark w-100 rounded p-2 mb-2">
  <div class="d-flex flex-row justify-content-between align-items-center">
    <div class="d-flex flex-column">
      <span class="object-id d-none">{{ object.id }}</span>
      <span class="object-title">{{ object.title }}</span>
      <span class="object-amount">{{ object.amount }} €</span>
      <span class="object-date">{{ object.date }}</span>
    </div>
    <i class="bi bi-chevron-right" id="chevron"></i>
  </div>

  <div class="d-none d-flex flex-column" id="moreInfo">
    <span class="object-description">{{ object.description }}</span>
    <span class="object-donor_name">Realizada por: {{ object.donor_name }}
      {{object.donor_surname}}</span>
    <span class="object-donor_email"><i>{{ object.donor_email }}</i></span>
  </div>
</div>
{% endfor %}
{% endblock %}

{% block scripts %}
<script id="object-data">
  const objectList = document.querySelectorAll('.object')
  const objetos = JSON.parse('{{ objects_json|escapejs }}')
  const preview = document.querySelector('#preview')
  const prevInfo = document.querySelector('#prev-info')
  const chevron = document.querySelector('#chevron')

  objectList.forEach(object => {
    const moreInfo = object.querySelector('#moreInfo')
    object.addEventListener('click', () => {
      const isMobile = window.matchMedia("(max-width: 768px)").matches

      const isExpanded = !moreInfo.classList.contains('d-none')
      const objectId = object.querySelector('.object-id').innerText
      const objectData = objetos.find(object => object.id == objectId)


      if (isMobile) {
        if (isExpanded) {
          moreInfo.classList.add('d-none')
          chevron.classList.remove('bi-chevron-down')
          chevron.classList.add('bi-chevron-right')
        } else {
          moreInfo.classList.remove('d-none')
          chevron.classList.remove('bi-chevron-right')
          chevron.classList.add('bi-chevron-down')
        }

  } else {

        prevInfo.classList.add('d-none')
        preview.classList.remove('text-center')
        preview.classList.add('p-5')
        preview.innerHTML = `
        <div class="row">
          <div class="col-12">
            <h3>${objectData.title}</h3>
            <h5>${objectData.description || "N/A"}</h5>
            <p>Cantidad: ${objectData.amount}€</p>
            <p>Fecha: ${objectData.date}</p>
            <p>Realizada por: ${objectData.donor_name + " " + objectData.donor_surname}</p>
            <p>Correo: ${objectData.donor_email}</p>
          </div>
        </div>
      `
      }

    })

    // when resizing the window, the preview will be reset
    window.addEventListener('resize', () => {
      moreInfo.classList.add('d-none')
      prevInfo.classList.remove('d-none')
      preview.classList.add('text-center')
      preview.classList.remove('p-5')
      preview.innerHTML = `<span id="prev-info">Pulsa sobre una {{ object_name }} para la vista previa</span>`

    })

  })

</script>
{% endblock %}